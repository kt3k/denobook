Deno にコントリビュートする
======

本章では Deno にコントリビュートするための手がかりを説明します.

# TOC

- Deno をビルドする
  - 準備
    - rust インストール
    - python インストール
    - node インストール
  - ビルド
  - テスト
- ディレクトリ構造
  - core
  - core/libdeno
  - cli
  - js
  - tools
  - third_party
  - tests
  - website
  - v8 関連
- 課題を見つける
  - ドキュメントタイポ修正
  - TODO コメント
  - Web 標準準拠
  - issue を解決する
    - roadmap 型 issue
    - リファクタ型 issue
- その他のコントリビュートの仕方
  - アイコンを作る
  - 記事を書く
    - コードリーディング
      - mizchi
      - bokuweb
      - leko
    - ベンチマーク
      - alexhultman

# Deno をビルドする

本体にコントリビュートするためには Deno 自体をビルドすることが入り口になります. 本節では Deno をビルドする方法を解説していきます.

## 準備

Mac, Windows 共通で以下のソフトウェアがインストールされている必要があります.

- rust 1.31.1 以上がインストールされていること
- python 2.7 がインストールされていること
- node.js がインストールされていること

上に加えて Mac の場合

- XCode がインストールされていること

Windows の場合

- VS Community 2017 with "Desktop development with C++" toolkit がインストールされていること

が必要になります.

## rust のインストール

rustup を使います.

```
curl https://sh.rustup.rs | sh
```

## python のインストール

Mac の場合はすでにインストールされています.

Windows の場合は...
```
```

## node.js のインストール

nvm などのバージョンマネージャからインストールしましょう.

## ビルドする

まずはリポジトリをクローンしましょう.

```
git clone https://github.com/denoland/deno.git
cd deno
```

Deno は git の submodule という仕組みを使っているので, submodule をアップデートしましょう
```
git submodule update --init
```

上のコマンドで `third_party` という Deno をビルドするためのサードパーティ依存全体を含んだレポジトリと `deno_std` という Deno の標準ライブラリが含まれたレポジトリがチェックアウトされます.

サブモジュールのインストールが終わったら, 次のコマンドでビルド用の準備ファイルを生成します (初回実行時のみネットワークアクセスが必要です).

```
./tools/setup.py
```

このコマンドで, 必要なバイナリ依存ファイルがダウンロードされたり, ビルド設定の ninja ファイルなどが `//target/` ディレクトリ以下に生成されます.

セットアップが完了したら, 次のコマンドで Deno をビルドしましょう.

```
./tools/build.py
```

上のコマンドは初回だと, 数分 ~ 数十分程度かかります. 2回目以降は, 修正箇所にもよりますが, かなり短縮されます(数秒 ~ 数十秒程度).

ビルドコマンドが成功すると `//target/debug/deno` というパスにビルドされた deno コマンドが生成されます. コマンドを叩いて動作を確認してみましょう.

```console
$ ./target/debug/deno -h
deno: 0.3.7
v8: 7.4.238
typescript: 3.4.1
```

上のように出力されれば, ビルドが成功しています.

## テストを実行する

下のコマンドでテストが実行されます.

```console
./tools/test.py
```

テストの実行にはネットワークアクセスが必要になります. (これは一部のテストがネットワークアクセスを必要としているためです.) テストの実行には数分程度の時間がかかります.

## コードフォーマットを実行する

下のコマンドでコードのフォーマット(整形)が実行されます.

```
./tools/format.py
```

上の1コマンドで GN, Python, C++, Rust, TypeScript, JavaScript 6言語のフォーマットが全て実行されます.

## リントを実行する

下のコマンドでリントが実行されます.

```
./tools/lint.py
```

上のコマンドで Python, C++, TypeScript, JavaScript のリントが実行されます. 上のコマンドには Rust のリントが含まれておらず, Rust のリントが自動化出来ていないことは残課題の1つです. Issue #

# ディレクトリ構造

この節では Deno 本体のディレクトリ構造を解説していきます.

## core

## core/libdeno

## cli

## js

## tools

# 課題の探し方

ここまでで, Deno の開発をする準備がかなり整ってきました.

ではここからは, どうやって実際にコントリビュートする課題を見つけるかを考えてみましょう.

```
探し方:
- マニュアルを読む (typo 探し)
- TODO コメントを探す
- issue を漁る (着手不可能なものも多い)
- 機能追加. 足りない API を見つける
- 機能追加. node の定番モジュールで deno_std に入っていないものを見つける
- web 標準準拠作業
- greenkeeping: package.json のアップデート

メタ探し方:
- なんでも良いので deno でコードを書く
- deno でまだ誰もやろうとしていないことをする
```

## マニュアルを読む (typo 探し)

コントリビュートを始めるための一番簡単な方法はマニュアルを熟読することです.

Deno の公式マニュアルは `https://deno.land/manual.html` にあります. かなり長いマニュアルですが, どこかに必ず typo (誤字) が含まれているはずです. typo を見つけたら, その修正をプルリクエストで投げましょう. `manual.html` のソースコードはレポジトリ内の `website/manual.md` です. 対応箇所をマークダウンファイルの中から見つけて修正し, プルリクエストを投げましょう.

なお, 他にも以下のようなドキュメントがあります.

- スタイルガイド: https://deno.land/style_guide.html
  - Deno の内部, およびサードパーティが従うべきコーディングスタイルを記述したドキュメント.
- ベンチマーク表: https://deno.land/benchmarks.html
  - Deno の各種ドキュメントを表示するページ.
- リリースノート: Releases.md
- 標準ライブラリのドキュメント: https://github.com/denoland/deno_std 以下の各種 README

これらをじっくり読めば, 数回はコントリビュートできるはずです. 筆者の最初2つのコントリビュートもドキュメントの typo 修正でした.

## TODO コメントを探す

とにかくコードにコントリビュートしたい時に課題を見つけやすいのが TODO コメントを眺めることです. TODO コメントにはかなり具体的にどうすべき/どうあるべきという指示が書かれている場合が多いです. その指示に従って修正しましょう. その指示に従った結果テストが通らなくなったり, なんらかの壁に阻まれる可能性はありますが, その難易度に応じて, 取り組むかどうかを決めましょう.

Pull #...

筆者の PR ですが, test を enable するという指示に従って単に enable しただけでコントリビュートが出来ました (テストが落ちる原因がどこかで解決されていたようです.)

## Issue を漁る

Issue を漁ることでコントリビュートする課題を見つけることが出来ます.

既知の未解決課題紹介

## API を提案する

Node.js の API にあって Deno にないものを見つけましょう.

また Web の API で Deno にあってもおかしくないものを見つけましょう.
