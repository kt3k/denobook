# はじめての Deno

目次

- 1 はじめに
  - 1-1 Deno ってなに
  - 1-2 Deno で出来ること
  - 1-3 Deno の特徴
- 2 Deno の開発環境を構築する
  - 2-1 Windows で Deno をインストールする
  - 2-2 Mac で Deno をインストールする
  - 2-3 Deno プログラムを実行するには
- 3 Deno プログラミングをはじめよう
  - 3-1 Deno で計算してみよう
  - 3-2 データを便利に扱う - 変数
  - 3-3 どちらが大きい? - 比較演算子
  - 3-4 色々なデータ型
- 4 プログラミングの基本編
  - 4-1 条件分岐
  - 4-2 for 文
  - 4-3 関数
  - 4-4 エラー
- 5 非同期処理
  - 5-1 プロミス
- 6 プログラムからファイルを読み書きする
  - 6-1 ファイルから読み込む命令
  - 6-2 ファイルに書き込む命令
- 7 サーバーを作ってみよう
  - 7-1 listen
  - 7-2 dinatra

# はじめに

本章ではプログラミングが初めての人向けに Deno の基本的な使い方を説明していきます.

## Deno ってなに?

Deno は JavaScript の実行エンジンです. Deno では JavaScript 言語と Deno 独自の命令を組み合わせて様々なプログラムを書くことが出来ます. Deno は 2010年代にアメリカのソフトウェアエンジニアによって開発が始められました. Deno という名前は, Deno が参考にしている JavaScript エンジンである "Node" のアナグラム (アルファベットの順番並び替え) として名付けられました. Deno は英語の Dino (Dinosaur = 恐竜) と発音が似ているため, Deno のマスコットキャラクターは恐竜になっています.

<!--
Deno は新しい JavaScript の実行環境です. Deno では JavaScript 言語でプログラムを書くことが出来ますが, 通常の JavaScript だけではなく, ファイルにアクセスしたり, サーバーを起動したりするための命令などが追加されています. Deno ではブラウザの JavaScript では出来ないような様々なプログラムを記述することが出来ます.

(Deno によく似た JavaScript の実行環境で Node があります. Node は2009年から開発が始められて, 今でも活発に開発されている JavaScript エンジンです. Deno は Node の抱える問題点を解決するために 2018年から新たに開発が始められた新しい JavaScript エンジンです.)

Deno はオープンソースの JavaScript 実行環境です. Deno は JavaScript を実行することが出来ますが, ブラウザ上ではなく, サーバー上で実行することが出来ます. Deno はクロスプラットフォームな実行環境なので, Deno で書いたプログラムは OS (windows / mac / linux) にかかわらず動かすことが出来ます.

Deno にとてもよく似ているもので Node があります. Node は 2009 年にリリースされて現在も開発が続けられている JavaScript の実行環境です. Deno は Node の作者が Node の設計で失敗してしまったことをやり直すために 2018 年に改めて 1 から開発を始めた, 新しいソフトウェアです.
-->

## Deno で出来ること

Deno は汎用の JavaScript のエンジンのため, コンピュータ上のあらゆる処理をプログラミングすることが出来ます. 例えばファイルを操作したり, インターネットからデータをダウンロードして収集したりするタスクは Deno は得意です. また, Deno はサーバーを立ち上げることも得意です. 標準ライブラリに含まれる http モジュールや, ws (WebSocket) モジュールを使えば, Web サービスのバックエンドになるサーバーを少ないコーディング量で作成することが出来ます.

<!--

Deno は JavaScript のエンジンです. Deno には通常のプログラミング言語のように, ファイルを読み書きしたり, ネットワークにアクセスするための様々な命令が用意されています. Web サーバーを作ったり, ネットワークにアクセスしてインターネットから情報を集めたりするのは Deno が得意とする仕事です.

JavaScript と聞くとブラウザを思い浮かべる人が多いかもしれません. Deno は JavaScript のエンジンですが, ブラウザとは直接関係がありません. Deno で動かしたプログラムを画面から操作したい場合には, 少し工夫が必要になります.
-->

<!--
通常のプログラミング言語と同じようにコンピュータ上で直接実行されます. Deno にはブラウザの JavaScript にはない様々な命令が追加

にファイルやネットワークなどコンピュータの持っているリソースに自由にアクセスする事が出来ます. Deno は Python, Ruby, PHP などのサーバーサイドのプログラミング言語に似ています.

Deno は汎用のプログラミング実行環境なので, プログラミングで出来ることは大体何でも出来ます. 特に以下のようなタスクは Deno でやるのに適しています:

- Web サーバーを作る
- Web サイトのスクレイピング
- コマンドラインツールを作る
- テキスト処理をする
- Websocket サーバーを作る
- etc
-->

## Deno の特徴

JavaScript で簡単に書けるシンプルなプログラミング環境というのが Deno の特徴ですが, それ以外にもいくつか特徴的な点があります.

### TypeScript も使える

Deno は JavaScript だけでなく TypeScript も実行することが出来ます. TypeScript は JavaScript よりも少し記述量が多くなる言語ですが, 代わりに型情報を記述することができるようになります. 型情報を書くことで, プログラムの部品がどういう型を持っているかが自動的にチェックされるようになるため, プログラムのバグを減らす事が出来ます.

通常 TypeScript を利用する場合は, Node.js 環境から利用します. その際 tsconfig.json という設定ファイルが必要になり, ts-node や typescript などの各種 npm モジュールのインストールが必要になったり, 各種の準備が必要になります. Deno はそれらの設定を全て内部に含んでいるため, なんの準備も必要なく, いきなり TypeScript のソースコードを実行することが出来ます.

### 独自のセキュリティ機構がある

Deno は特殊なセキュリティのコントロールの仕組みを持っています. Deno は実行時にコマンドラインオプションで, プログラムが何をして良い, 何はしてはいけないということをあらかじめ決めてから実行します. 例えば, リンターのようなファイルの読み込みしか必要としないはずのプログラムはファイルの読み込み権限だけを与えて実行するのが適切です. リンターがネットワークアクセスを使用していたら何かがおかしい疑いがあります. Deno ではこのようなケースで

```
deno --allow-read linter.ts
```

のようにプログラムを実行することで, 実際にファイル読み込みしか許可しない状態でプログラムを実行できます.

このように, Deno では, そのプログラムが本来使用するべきコンピュータの機能に絞って権限を渡す仕組みがあります. これは意図しない第3者の攻撃コードがソースコードに混入してしまった場合に, 被害を防げるという利点があります.

近年 Node では, パッケージレジストリの npm に攻撃コードの混入が見つかるケースが増えています. 攻撃者は典型的には攻撃コードを使って, そのコンピュータの機密情報を盗もうとしますが, その際攻撃者は自分が用意した受信用サーバーに機密情報を送信する必要があります. Deno のセキュリティの仕組みを使えばこの送信時のネットワークアクセスを防ぐことが出来るため, このようなタイプの攻撃が成り立たなくなります.

<!--
Node のパッケージレジストリの npm では最近では攻撃コードの混入が見つかるケースが相次いで発覚しています. npm には, 大小様々な規模のライブラリが登録されていて, ライブラリがさらに別のライブラリに依存するのが当たり前になっています. 結果的に一つの業務アプリを作る場合に依存するモジュール数が10万を超えるようなことは当たり前になってきています. そういう中で全ての依存モジュールをいちいち監査しながら開発をすることは不可能であり, そこに目をつけた攻撃者が多くのパッケージから依存されてるパッケージを乗っ取り攻撃コードを混入させる行為が後を絶ちません.

Deno の特徴の一つで独特なセキュリティのコントロールがあります. Deno は実行時にコマンドラインオプションで, プログラムが何をして良い, 何はしてはいけないということをあらかじめ決めてから実行します. そのため, そのプログラムのどこかに, 意図せず攻撃者の仕組んだ攻撃コードが入っていたとしても, セキュリティのコントロールをしていれば被害を防ぐことが出来ます. Node の世界では毎年何回か npm モジュールが攻撃者に乗っ取られて, 攻撃コードがモジュールに混入される被害が年に数回は起きていますが, Deno ではそのような攻撃を Deno のセキュリティ機能を使って防ぐことが出来ます.
-->

# Deno の開発環境を構築しよう

それでは実際に Deno を動かすための環境を構築していきましょう.

## Windows で Deno をインストールする

この節では Windows に Deno をインストールする方法を説明します.

- コルタナを開く
- ターミナルを開く
- DL コマンドを叩く
- tips: scoop
- 環境変数の設定
- deno コマンドの確認

## Mac で Deno をインストールする

{図: マック, デスクトップ}

画面右上の🔍をクリックしてスポットライトを開いてください.

スポットライトの検索ボックスに「ターミナル」と入力して, ターミナルアプリを選択してください.

{図: ターミナル}

上のようなターミナル画面が開いたはずです.

ターミナル上で, 下のコマンドを入力して Deno をダウンロードしましょう.

```
curl -L deno.land/x/install/install.sh | sh
```

ダウンロード完了したら, 以下の行を `~/.bash_profile` に追加して `deno` コマンドにパスを通します.

```
export PATH=$HOME/.deno/bin:$PATH
```

以上を `~/.bash_profile` に追加したら, 下のコマンドを打って, `~/.bash_profile` を再ロードします.

```
. ~/.bash_profile
```

ここまでで Deno のインストールは完了です. インストールできたことを確認するために, 下のコマンドを打ってみてください:

```
deno -h
```

インストールが成功していたら, 以下のような `deno` コマンドのヘルプメッセージが表示されるはずです.

```
$ deno -h
deno
A secure runtime for JavaScript and TypeScript built with V8, Rust, and Tokio.

Docs: https://deno.land/manual.html
Modules: https://github.com/denoland/deno_std
Bugs: https://github.com/denoland/deno/issues

To run the REPL:

  deno

To execute a sandboxed script:
...
```

上のメッセージが確認できたら, インストールは完了です.

---

tips: Homebrew をインストールしている場合は brew コマンドでもインストールできます.

```
brew install deno
```

こちらのコマンドでインストールする場合は `~/.bash_profile` の編集は不要です

## Deno プログラムの実行の仕方

Deno のプログラムの実行の仕方は大きく分けて2種類あります.

1つはインタラクティブシェル(対話型入力欄)からプログラムを直接入力するやり方です. もう1つはファイルに保存した Deno プログラムを `deno` コマンドに読み込ませて実行するやり方です.

### インタラクティブシェルから Deno プログラムを実行する

先ずはインタラクティブシェルから Deno プログラムを実行する方法を説明します.

インストールの節で説明した方法で, 先ずはターミナルを起動してください.

ターミナルで, 次のように `deno` とだけ入力してください.

```
deno
```

すると次のように `>` の記号が表示されるはずです.

```
deno
>
```

このような表示にならなかった場合は, インストールがうまくできていません. 前の節に戻って, インストールの手順をもう一度確認してみましょう.

`>` の記号が表示されたら, ここに Deno プログラムを入力することが出来ます.

まずは以下のように入力してみましょう.

```
> console.log("hello world")
```

すると次のように 1行下に `hello world` の文字が出力されるはずです.

```
> console.log("hello world")
hello world
```

上の出力が確認できれば, インタラクティブシェルからの Deno プログラムの実行が成功したことになります.

### Deno プログラムを書いたファイルを実行する

次にファイルから Deno プログラムを実行してみましょう.



# Deno プログラミングをはじめよう

ここまでで Deno でプログラムを動かすことが出来るようになりました. この章からは, Deno を使って本格的なプログラミングを学んでいきましょう.

## Deno で計算してみよう

- 足し算, 引き算
- 掛け算, 割り算
- 優先順位
- 剰余
- べき乗

それではターミナルで deno (windows では deno.exe) と入力してみましょう.

```
$ deno
>
```

上のような記号 (`>`) が表示されたはずです. この画面は Deno のインタラクティブシェルというもので, Deno に色々な式の値を聞く事が出来ます. ではまず 1 + 1 が何になるかを Deno に聞いてみましょう

```
> 1 + 1
2
```

2 と出ましたね. では次に 3 * 4 を聞いてみましょう

```
> 3 * 4
12
```

12 と出てきましたね. このように Deno のインタラクティブシェルに色々な式を入力すると, その式が Deno の中でいくつになるかを表示する事が出来ます.

## データを便利に扱う - 変数

# 参考文献
- 考える力が身につく Python 「超」入門 鎌田正浩
- JavaScript Primer @azu
