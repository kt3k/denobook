# 私が Deno にコントリビュートする理由

2018 年 6 月の JSConf EU で Deno が初めて発表されてから 1 年が経ちました.

日本では 2018 年 12 月ごろから Deno の周辺で作業をする人が増え, 2019 年 1 月頃から定期的に Meetup `#deno_ja` が開催されるようになりました.

`#deno_ja` では毎回, 冒頭で簡単な自己紹介をするのですが, よくよく聞いていると早く Deno を始めた人でも 12 月ぐらいの人が多いことに気づきました. 自分だけが Deno 開始直後からコントリビュートを開始していて, そんな人は自分しかいません. そしてなぜそんな時期から Deno にコントリビュートしているのか, 自分にとって Deno は何なのかを全く説明していないことに気がつきました.

この記事では, なぜ自分が Deno にそこまでコントリビュートするのかの理由を説明してみようと思います.

# Deno の発見

自分が Deno に気づいたきっかけは GitHub のタイムラインです. 自分はライアンダールをフォローしていたので, @ry が deno というレポジトリをオープンソースにしたというメッセージがストリームに流れてきました. その頃自分はストリームは基本的に全て目を通していて, 面白そうなレポジトリが star されていないか, 面白そうなプロジェクトを始めた人がいないかを常に監視していました. @ry が数年間 github 上で一切活動していないということを自分は記憶していたため, `@ry open sourced deno` というメッセージはかなり異様に見えました. 中身を見てみると, `A JavaScript runtime using V8 6.8 and Go.` という文から始まる deno の機能リストが書かれていました. 説明の中で typo を見つけたので PR で修正を投げてみるとすぐにマージされました. @ry が github 上で活動するつもりがあるらしい? その 3 日後 JSConf EU で Deno が発表されました. そういうことか, と思いました.

# ライアン・ダール (@ry) について

自分がライアンダールを知ったのはおそらく Node.js のコントリビュータのグラフを見ていた時だと思います. Node.js は今は有名だけれど, そのソフトウェアはライアン・ダールという人物によって作られたらしい. 作者を知ると自分は大抵その作者が最近はどのプロジェクトでアクティブなのかをチェックします. 自分がライアンダールを知った時にはすでに @ry は github には何もコントリビュートしていませんでした. Node.js のような世界へのインパクトが大きいソフトウェアを作った人間が何も OSS 活動しなくなるのはなんとなく奇妙だなと思いました.

その後 自分はフロントエンドエンジニアという職業柄 Node.js を毎日使うようになっていきます. npm にも 100個近いモジュールをパブリッシュしました. 自分の Node.js への依存度が上がっていくに従って, 今はどこかに行ってしまった作者の @ry の存在がますます謎に思えるようになっていきました.

そんなある時, あるポッドキャストに @ry が出演していました. その中で @ry は Node.js を批判し, Go 言語を最高の言語と賞賛していました. 今や Node.js は非常に大きなプロジェクトです. npm には他のどの言語より多くのパッケージが登録されています. Node.js が有効なソフトウェアであることは誰もが認める世の中になった状況で, 作者が突然現れてそのソフトウェアを批判し, 否定するという行動に衝撃を受けました.

ポッドキャストから約1年後にライアン・ダールは Deno を発表しました. 発表内容はよく知られるように, Node.js は間違いだらけのソフトウェアであり, もはや修正不可能なので Deno を作ってそれを解決するという内容です. Node.js のような成功の象徴のようなソフトウェアを否定して, 全くゼロから Node.js に競合するソフトウェアを作っていくという姿勢にかなりの異常性を感じました.

この人間は一体なんなんだろう, この人間は一体どういう考え方をしているんだろう, という興味が湧きました. それから自分は Deno リポジトリをウォッチし始めるようになりました.

# Node.js について

2016年ごろに `@yosuke_furukawa` がリクルートに転職してきてから, Node 学園の存在を知りました. Node 学園に通ううちに Node.js の最新情報や舞台裏でコラボレータがどういう作業をしているのかがなんとなく見えるようになってきました. Node.js コラボレータである会長や @hiroppy さんの Node.js 知識がすごいなと思う一方で, そこまで Node.js にのめり込めないでいる自分を感じていました. 今や Node.js は大きすぎて, 全貌を把握するにはあまりにも大きすぎるし, 歴史が長すぎるため, 今からそれを追いかけようという気にはなれませんでした.

そんな気持ちでなんとなく Node.js を斜めうしろから眺めている時に, Deno はある意味で歴史を過去に戻して 1 から出直す Node.js のように見えました. Deno を作る過程に参加することで Node.js が作られた過程を少し理解できるのではないか. Node.js を倒そうとする行為に参加することで Node.js をより理解できるのではないか, という考えが Deno にコントリビュートするモチベーションの一つになっています.

# Gitster さん

Deno にコントリビュートを始めた時に少し頭をよぎったインタビュー記事があります. git のメンテナーの濱野さんの[記事](https://gihyo.jp/dev/serial/01/alpha-geek/0040)です. インタビューの中で濱野さんはまだ 1200行程度だった頃の git のソースコードを読んで, 2時間で理解し, それから git merge のアルゴリズムの実装を始めたという話が出てきます. その後濱野さんは git を Linus から託され, 今もメンテナーです. こういう一つのソフトウェアの生い立ちからの履歴を全部追うという体験はどういうものなんだろう, という興味が自分の中で昔からなんとなくありました. そういう履歴を全部追う実体験をしてみる場として Deno を選んでみたという側面も, コントリビューションを継続する理由の一つになっています.

# import

ここまで, 外的な要因を主に述べましたが, Deno のソフトウェアとして特徴にも, コントリビュートを続ける理由があります. 大きなものの一つが import の仕様です. 自分は Node.js の import はあまり好きではありません. Node.js の世界で import が広く使われだしたのは babel 5 の存在が大きかったと思います. (それ以前にも D3 のビルドツールの smash などは独自の import の解釈を実装していましたが, 広くは使われていませんでした.) その後 webpack が babel に依存しない import を実装し, rollup が import に最適化された bundler として登場し, 最近では Node.js 自体にも import が入ろうとしています. それぞれのツールはそれぞれ細かい点で微妙に違った import を実装していますが, 共通しているのは Node.js の世界の import は URL を import 出来ず, 相対 path でない識別子から始まる対象 (例えば import "react") の場合は node_modules 以下を見に行くという点です. これは明らかにブラウザの import と違っています. 個人的にはこの仕様の違いはかなり気持ちが悪いと思っていますし, おそらく未来の Node.js でも解決されないと予想しています.

Deno の import は単純に browser と互換性のある解決の仕方をします. つまり import できる対象は常に URL だけです. この大胆な単純さが自分はとても気に入っていて, 本当の import をしているという印象を受けます. Node.js は今後 Node の世界での import が何かを徐々に定義して行くと思われますが, それはおそらく非常にときめかない仕様になっていくでしょう. CommonJS に感謝しつつ, それを片付ける時期が来ているように感じます.

# Security

Deno に特有な仕様で最も興味深いものが, 独自のセキュリティレイヤーです. Deno は起動時に Deno が何をして良いかをコマンドラインオプションで指定します.

```
deno --allow-read script.ts
```

このコマンドで script.ts はファイルの読み込みだけが出来ます. ファイルの書き込みや, ネットワークへの送信などは出来ません. (しようとする場合は, プロンプトでその書き込み/アクセスをして良いかを聞いてきます.) つまり上のコマンドを実行する時点で, script.ts がどんな内容であっても, 上のコマンドでコンピュータが破壊されたり, 外部に機密情報が漏れたりすることがないことが保証されます. 自分が知る限り, こういう特徴を持った言語はかなり珍しいように思います. かつ, サーバーを走らせるような用途の言語にとってはかなり有効な機能のように思われます. Node.js の世界では最近では, 定期的に npm package が攻撃者によって乗っ取られ, 機密情報を外部サーバーに送信されるというような事件が発生しています. Deno であればこのような問題は上のセキュリティの仕組みによってブロックされます. もし Deno と Node でほとんど同じことが実現できるぐらいに Deno が成長した場合, 殆どの人はこのセキュリティ機構のメリットを理由に Deno を使うのではないかと個人的には予想しています.

# Deno コミュニティ

はじめは上のような個人的な理由から Deno にコントリビュートを続けていましたが,
